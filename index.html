<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard Rey CFO</title>
  <style>
    :root {
      --bg: #032836;
      --card: #06394b;
      --accent: #22d3ee;
      --accent-soft: rgba(34,211,238,0.15);
      --text: #f9fafb;
      --muted: #9ca3af;
      --danger: #f97373;
      --success: #4ade80;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #075985, #020617 60%);
      color: var(--text);
      padding: 24px;
    }
    .shell {
      max-width: 1200px;
      margin: 0 auto;
      border-radius: 24px;
      background: linear-gradient(135deg, rgba(15,23,42,0.96), rgba(8,47,73,0.96));
      padding: 20px 24px 28px;
      box-shadow: 0 20px 45px rgba(0,0,0,0.45);
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    header h1 {
      font-size: 20px;
      margin: 0;
    }
    header span {
      font-size: 12px;
      color: var(--muted);
    }
    .grid {
      display: grid;
      grid-template-columns: 2fr 1.6fr 2fr;
      grid-template-rows: auto auto;
      gap: 16px;
    }
    .card {
      background: var(--card);
      border-radius: 18px;
      padding: 16px 16px 18px;
      box-shadow: 0 8px 18px rgba(0,0,0,0.45);
      border: 1px solid rgba(148,163,184,0.15);
    }
    .card h2 {
      margin: 0 0 8px;
      font-size: 14px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .card h2 span.icon {
      font-size: 16px;
    }
    .card small {
      color: var(--muted);
      font-size: 11px;
    }
    /* Saldos bancarios */
    .balances-grid {
      margin-top: 8px;
      display: grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 8px;
    }
    .balance-item {
      background: rgba(15,23,42,0.7);
      border-radius: 12px;
      padding: 8px 10px;
      border: 1px solid rgba(148,163,184,0.2);
    }
    .balance-label {
      font-size: 11px;
      color: var(--muted);
      margin-bottom: 4px;
    }
    .balance-amount {
      font-size: 16px;
      font-weight: 600;
    }
    .balance-tag {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(34,197,94,0.15);
      color: var(--success);
      margin-left: 4px;
    }
    /* Ventas semanales */
    .sales-bars {
      margin-top: 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      font-size: 11px;
    }
    .sales-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .sales-label { width: 75px; color: var(--muted); }
    .sales-bar-track {
      flex: 1;
      height: 8px;
      border-radius: 999px;
      background: rgba(15,23,42,0.8);
      overflow: hidden;
    }
    .sales-bar-fill {
      height: 100%;
      border-radius: inherit;
      background: linear-gradient(90deg, var(--accent), #4ade80);
      width: 60%;
    }
    .sales-value {
      width: 52px;
      text-align: right;
      font-variant-numeric: tabular-nums;
    }
    /* Tasks hoy */
    .tasks-list {
      margin-top: 10px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 11px;
      max-height: 160px;
      overflow-y: auto;
    }
    .task-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 8px;
      background: rgba(15,23,42,0.72);
      border-radius: 10px;
      border: 1px solid rgba(148,163,184,0.2);
    }
    .task-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--accent);
      flex-shrink: 0;
    }
    .task-text { flex: 1; }
    .task-time { color: var(--muted); white-space: nowrap; }
    /* Calendario mini */
    .calendar-mini {
      margin-top: 10px;
      font-size: 11px;
    }
    .calendar-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }
    .calendar-events {
      margin-top: 8px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      max-height: 150px;
      overflow-y: auto;
    }
    .event-item {
      padding: 6px 8px;
      border-radius: 10px;
      background: rgba(15,23,42,0.8);
      border: 1px solid rgba(148,163,184,0.2);
    }
    .event-time { font-size: 11px; color: var(--muted); }
    .event-title { font-size: 11px; font-weight: 500; }
    /* Chat */
    .chat-card {
      grid-column: 1 / span 3;
      margin-top: 4px;
    }
    .chat-window {
      margin-top: 10px;
      background: rgba(15,23,42,0.9);
      border-radius: 14px;
      border: 1px solid rgba(148,163,184,0.35);
      height: 170px;
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      overflow-y: auto;
      font-size: 11px;
    }
    .chat-msg {
      max-width: 75%;
      padding: 6px 8px;
      border-radius: 12px;
    }
    .chat-msg.me {
      align-self: flex-end;
      background: linear-gradient(135deg,#22d3ee,#38bdf8);
      color: #0f172a;
    }
    .chat-msg.bot {
      align-self: flex-start;
      background: rgba(15,23,42,0.95);
      border: 1px solid rgba(148,163,184,0.45);
    }
    .chat-input-row {
      margin-top: 8px;
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .chat-input {
      flex: 1;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.5);
      padding: 6px 12px;
      font-size: 11px;
      background: rgba(15,23,42,0.8);
      color: var(--text);
    }
    .chat-btn {
      border-radius: 999px;
      border: none;
      padding: 6px 14px;
      font-size: 11px;
      background: var(--accent);
      cursor: pointer;
    }
    @media (max-width: 800px) {
      .grid { grid-template-columns: 1fr; }
      .chat-card { grid-column: 1 / span 1; }
    }
  </style>
</head>
<body>
  <div class="shell">
    <header>
      <div>
        <h1>Dashboard CFO ‚Äì Rey</h1>
        <span>Visi√≥n r√°pida: bancos ¬∑ ventas ¬∑ tareas ¬∑ calendario ¬∑ asistente</span>
      </div>
      <div><span id="hora-header"></span></div>
    </header>

    <div class="grid">
      <!-- 1) SALDOS BANCARIOS -->
      <section class="card">
        <h2><span class="icon">üí∞</span>Saldos bancarios</h2>
        <small>Resumen de todas tus cuentas principales (API_SALDOS)</small>
        <div class="balances-grid">
          <div class="balance-item">
            <div class="balance-label" id="label-1">Cuenta 1</div>
            <div class="balance-amount"><span id="saldo-1">$0.00</span> <span class="balance-tag">OK</span></div>
          </div>
          <div class="balance-item">
            <div class="balance-label" id="label-2">Cuenta 2</div>
            <div class="balance-amount"><span id="saldo-2">$0.00</span> <span class="balance-tag">OK</span></div>
          </div>
          <div class="balance-item">
            <div class="balance-label" id="label-3">Cuenta 3</div>
            <div class="balance-amount"><span id="saldo-3">$0.00</span></div>
          </div>
          <div class="balance-item">
            <div class="balance-label" id="label-4">Cuenta 4</div>
            <div class="balance-amount"><span id="saldo-4">$0.00</span></div>
          </div>
        </div>
      </section>

      <!-- 2) VENTAS SEMANALES (por ahora demo) -->
      <section class="card">
        <h2><span class="icon">üìà</span>Ventas semanales (√∫ltimas 3)</h2>
        <small>Comparativo global de todas las sucursales</small>
        <div class="sales-bars">
          <div class="sales-row">
            <div class="sales-label">Semana -2</div>
            <div class="sales-bar-track"><div class="sales-bar-fill" style="width:55%"></div></div>
            <div class="sales-value">$0k</div>
          </div>
          <div class="sales-row">
            <div class="sales-label">Semana -1</div>
            <div class="sales-bar-track"><div class="sales-bar-fill" style="width:70%"></div></div>
            <div class="sales-value">$0k</div>
          </div>
          <div class="sales-row">
            <div class="sales-label">Semana 0</div>
            <div class="sales-bar-track"><div class="sales-bar-fill" style="width:65%"></div></div>
            <div class="sales-value">$0k</div>
          </div>
        </div>
      </section>

      <!-- 3) TASKS DE HOY (din√°micas desde Google Sheets) -->
      <section class="card">
        <h2><span class="icon">üìù</span>Tasks de hoy</h2>
        <small>Tareas con fecha l√≠mite HOY (PIZARRON DE PENDIENTES)</small>
        <div id="tasks-list" class="tasks-list">
          <div class="task-item">
            <div class="task-dot"></div>
            <div class="task-text">Cargando tareas...</div>
            <div class="task-time"></div>
          </div>
        </div>
      </section>

      <!-- 4) AGENDA -->
      <section class="card">
        <h2><span class="icon">üìÖ</span>Agenda de hoy (Google Calendar)</h2>
        <small>Sincronizada con tu calendario principal (demo visual)</small>
        <div class="calendar-mini">
          <div class="calendar-row">
            <span>Hoy ¬∑ Jueves 21</span>
            <span>3 eventos</span>
          </div>
        </div>
        <div class="calendar-events">
          <div class="event-item">
            <div class="event-time">09:30 ‚Äì 10:15</div>
            <div class="event-title">Revisi√≥n flujo de efectivo</div>
          </div>
          <div class="event-item">
            <div class="event-time">11:00 ‚Äì 12:00</div>
            <div class="event-title">Llamada con socios</div>
          </div>
          <div class="event-item">
            <div class="event-time">17:00 ‚Äì 17:30</div>
            <div class="event-title">Planeaci√≥n fiscal mensual</div>
          </div>
        </div>
      </section>

      <!-- 5) CHATBOT -->
      <section class="card chat-card">
        <h2><span class="icon">ü§ñ</span>Asistente Rey ¬∑ Chatbot Poderoso</h2>
        <small>Habla con tu asistente: bancos, ventas, tareas, ideas y m√°s</small>
        <div class="chat-window">
          <div class="chat-msg bot">Hola Rey üëë, tengo listo tu resumen de hoy. ¬øQu√© necesitas revisar primero?</div>
          <div class="chat-msg me">Dime las ventas de las √∫ltimas 3 semanas y si alguna sucursal viene cayendo.</div>
          <div class="chat-msg bot">Claro. Semana actual ligeramente abajo (-4%) vs semana pasada. Sucursal Centro lleva 2 semanas seguidas a la baja.</div>
        </div>
        <div class="chat-input-row">
          <input class="chat-input" placeholder="Escr√≠bele algo a tu asistente..." />
          <button class="chat-btn">Enviar</button>
        </div>
      </section>
    </div>
  </div>

  <script>
    // URLs de datos
    const SALDOS_URL =
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vTJLWVPOcYt3HzpNsFLTyQXSvflg-u8F27IEWhx03PHcdFlWJS7PlDNU7jT64K9aLtlDAVCWsJe8zG7/pub?gid=348652076&single=true&output=csv";

    // PIZARRON DE PENDIENTES (AGENDA 2025)
    const TASKS_URL =
      "https://docs.google.com/spreadsheets/d/1mg-HWdEOzrZn5B0wOq-pmv5ISeTSQ8TeezVqGutdqOY/export?format=csv&gid=977319746";

    // Utilidades
    function formatoMonedaMX(valor) {
      const limpio = (valor || "").toString().replace(/[^0-9.\-]/g, "");
      const num = Number(limpio);
      if (Number.isNaN(num)) return "$0.00";
      return num.toLocaleString("es-MX", {
        style: "currency",
        currency: "MXN",
        minimumFractionDigits: 2,
        maximumFractionDigits: 2,
      });
    }

    function fechaHoyStr() {
      const d = new Date();
      const dd = String(d.getDate()).padStart(2, "0");
      const mm = String(d.getMonth() + 1).padStart(2, "0");
      const yyyy = d.getFullYear();
      return `${dd}/${mm}/${yyyy}`;
    }

    // -------- SALDOS BANCARIOS --------
    function cargarSaldos() {
      fetch(SALDOS_URL)
        .then(res => res.text())
        .then(texto => {
          const lineas = texto.trim().split(/\r?\n/);
          if (lineas.length < 2) return;

          const header = lineas[0].split(",").map(h => h.trim().toLowerCase());
          const filas = lineas.slice(1).map(l => l.split(","));

          const ixCuentaId = header.findIndex(h => h === "cuenta_id");
          const ixNombre   = header.findIndex(h => h === "nombre");
          const ixSaldo    = header.findIndex(h => h === "saldo");

          if (ixCuentaId === -1 || ixNombre === -1 || ixSaldo === -1) {
            console.error("No encontr√© columnas cuenta_id / nombre / saldo", header);
            return;
          }

          const registros = filas
            .map(cells => {
              const cuenta_id = (cells[ixCuentaId] || "").trim();
              const nombre    = (cells[ixNombre]   || "").trim();
              const saldoRaw  = cells.slice(ixSaldo).join("").trim();
              return { cuenta_id, nombre, saldo: saldoRaw };
            })
            .filter(r => r.cuenta_id && r.nombre && r.saldo);

          const cards = [
            { labelId: "label-1", saldoId: "saldo-1" },
            { labelId: "label-2", saldoId: "saldo-2" },
            { labelId: "label-3", saldoId: "saldo-3" },
            { labelId: "label-4", saldoId: "saldo-4" },
          ];

          cards.forEach((card, idx) => {
            const reg = registros[idx];
            if (!reg) return;
            const labelEl = document.getElementById(card.labelId);
            const saldoEl = document.getElementById(card.saldoId);
            if (labelEl) labelEl.textContent = reg.nombre;
            if (saldoEl) saldoEl.textContent = formatoMonedaMX(reg.saldo);
          });
        })
        .catch(err => console.error("Error cargando saldos:", err));
    }

    // -------- TASKS HOY --------
    function cargarTasksHoy() {
      const hoy = fechaHoyStr();
      fetch(TASKS_URL)
        .then(res => res.text())
        .then(texto => {
          const contenedor = document.getElementById("tasks-list");
          if (!contenedor) return;

          const lineas = texto.trim().split(/\r?\n/);
          if (lineas.length < 2) {
            contenedor.innerHTML = "<div class='task-item'><div class='task-text'>Sin tareas encontradas.</div></div>";
            return;
          }

          const header = lineas[0].split(",").map(h => h.trim().toLowerCase());
          const filas = lineas.slice(1).map(l => l.split(","));

          const ixTema        = header.findIndex(h => h === "tema");
          const ixResponsable = header.findIndex(h => h === "responsable");
          const ixFecha       = header.findIndex(h => h === "fecha limite" || h === "fecha_limte" || h === "fecha_l√≠mite");

          if (ixTema === -1 || ixResponsable === -1 || ixFecha === -1) {
            console.error("No encontr√© columnas tema / responsable / fecha limite", header);
            contenedor.innerHTML = "<div class='task-item'><div class='task-text'>No se pudieron leer las columnas de tareas.</div></div>";
            return;
          }

          const tareasHoy = filas
            .map(cells => {
              const tema = (cells[ixTema] || "").trim();
              const responsable = (cells[ixResponsable] || "").trim();
              const fecha = (cells[ixFecha] || "").trim();
              return { tema, responsable, fecha };
            })
            .filter(t => t.tema && t.fecha === hoy);

          contenedor.innerHTML = "";

          if (!tareasHoy.length) {
            contenedor.innerHTML = `
              <div class="task-item">
                <div class="task-dot"></div>
                <div class="task-text">Sin tasks con fecha l√≠mite hoy üéâ</div>
                <div class="task-time"></div>
              </div>
            `;
            return;
          }

          tareasHoy.forEach(t => {
            const item = document.createElement("div");
            item.className = "task-item";
            item.innerHTML = `
              <div class="task-dot"></div>
              <div class="task-text">${t.tema}</div>
              <div class="task-time">${t.responsable || ""}</div>
            `;
            contenedor.appendChild(item);
          });
        })
        .catch(err => console.error("Error cargando tasks:", err));
    }

    // -------- RELOJ HEADER --------
    function actualizarHora() {
      const ahora = new Date();
      const fecha = ahora.toLocaleDateString("es-MX", {
        weekday: "short",
        day: "2-digit",
        month: "2-digit",
        year: "numeric",
      });
      const hora = ahora.toLocaleTimeString("es-MX", {
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit",
      });
      const el = document.getElementById("hora-header");
      if (el) el.textContent = `${fecha} ¬∑ ${hora}`;
    }

    // Primera carga
    cargarSaldos();
    cargarTasksHoy();
    actualizarHora();

    // Auto‚Äìrefresh cada 60 segundos
    setInterval(cargarSaldos, 60 * 1000);
    setInterval(cargarTasksHoy, 60 * 1000);
    setInterval(actualizarHora, 1000);
  </script>
</body>
</html>
